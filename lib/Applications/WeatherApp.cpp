#include <WeatherApp.h>

#define WUNDERGROUND_API_KEY      "b9cd2ae34c2974b6"
#define WUNDERGROUND_LANGUAGE     "DE"
#define WUNDERGROUND_ZMW_CODE     "00000.8.10641"

static unsigned char sun[]={0x24,0x18,0xbd,0x7e,0x7e,0xbd,0x18,0x24};
static unsigned char mask[]={0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff};
static unsigned char cloud[]={0x00,0x00,0x00,0x06,0x6f,0xef,0xff,0x7e};
static unsigned char highcloud[]={0x3,0x7,0x7,0x7,0x7,0x3,0x3,0x1};
static unsigned char rain[]={0x80,0x10,0x40,0x0,0x90,0x0,0x28,0x80};
static unsigned char snow[]={0x63,0x55,0x36,0x8,0x36,0x55,0x63,0x0};
static const uint16_t cloud1[]={	0x000, 0x001, 0x003, 0x005, 0x007, 0x00A, 0x00F, 0x000, 
	0x020, 0x021, 0x023, 0x025, 0x027, 0x02A, 0x02F, 0x020, 
	0x040, 0x041, 0x043, 0x045, 0x047, 0x04A, 0x04F, 0x040, 
	0x060, 0x061, 0x063, 0x065, 0x067, 0x06A, 0x06F, 0x060, 
	0x080, 0x081, 0x083, 0x085, 0x087, 0x08A, 0x08F, 0x080, 
	0x0A0, 0x0A1, 0x0A3, 0x0A5, 0x0A7, 0x0AA, 0x0AF, 0x0A0, 
	0x0F0, 0x0F1, 0x0F3, 0x0F5, 0x0F7, 0x0FA, 0x0FF, 0x0F0, 
	0x000, 0x001, 0x003, 0x005, 0x007, 0x00A, 0x00F, 0x000, };

void WeatherApp::render(DisplayManager& display) {

    if (conditions.weatherIcon == "cloudy") {
        display.drawBitmap(cloud, {0, 0}, {255, 255, 255}, 8, 8);
    } else if (conditions.weatherIcon == "partlycloudy") {
        display.drawBitmap(sun, {0, 0}, {255, 255, 0}, 8, 8);
        display.drawBitmap(cloud, {0, 0}, {255, 255, 255}, 8, 8);
    } else if (conditions.weatherIcon == "rain") {
        display.drawBitmap(rain, {0, 0}, {0, 0, 255}, 8, 8);
    } else if (conditions.weatherIcon == "snow") {
        display.drawBitmap(snow, {0, 0}, {255, 255, 255}, 8, 8);
    } else if (conditions.weatherIcon == "tstorms") {

    } else {
        display.drawBitmap(sun, {0, 0}, {255, 255, 0}, 8, 8);
    } 
//display.drawApp(cloud1,conditions.currentTemp + "\xA7",{0,0},{255, 255, 255},false,true,50,200);
    display.drawText(conditions.currentTemp + "\xA7", {9, 0}, {255, 255, 255}, false,false);
}

void WeatherApp::update() {
    wunderground.updateConditions(&conditions, WUNDERGROUND_API_KEY, WUNDERGROUND_LANGUAGE, WUNDERGROUND_ZMW_CODE);
}
